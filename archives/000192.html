<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />

<title>Curiosity is bliss: How to write C++ XPCOM components</title>

<link rel="stylesheet" href="http://blog.monstuff.com/styles-site.css" type="text/css" />
<link rel="alternate" type="application/rss+xml" title="RSS" href="http://blog.monstuff.com/index.rdf" />

<link rel="start" href="http://blog.monstuff.com/" title="Home" />

<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
        m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', '{{ site.ga }}', 'auto');
    ga('send', 'pageview');
</script>

</head>

<body>

<div id="banner">
<h1><a href="http://blog.monstuff.com/" accesskey="1">Curiosity is bliss</a></h1>
<span class="description">Julien Couvreur's programming blog and more</span>
</div>

<div id="container">


<div class="blog">




<div class="blogbody">

<h2 class="title">How to write C++ XPCOM components</h2>

<p>I've been playing around with XPCOM to extend the functionality of Firefox. <a href="http://www.mozilla.org/projects/xpcom/book/cxc/html/">"Creating XPCOM components"</a> is the best step by step introduction I have found so far. It details how to develop a C++ XPCOM component using windows and Visual Studio (2003). <br />
Here's the summary of the steps: </p>

<a name="more"></a>
<ol><li>Download the Gecko SDK. It allows you to write XPCOM components without building Mozilla itself (which I still didn't manage to do :-[ ). </li><li>Start an empty Win32 project in Visual Studio, selecting the "Dynamic Linked Library (DLL)" option. </li><li>Create and IDL file describing the interface of your component. </li><li>Run xpidl twice on the IDL file, with "xpidl -I &lt;geckosdk/idl path> -m header &lt;yourIDL file>" and "xpidl -I &lt;geckosdk/idl path> -m typelib &lt;yourIDL file>". </li><li>Create a cpp file that includes the generated header file (which includes a a handy template for your class). </li><li>Implement the main entry point (NSGetModule) and the XPCOM module and factory, as well as your own component (matching the signature in the generated header file). The tutorial provides a sample file which you can re-use (but there are some little code mistakes, see errata section). </li><li>Configure Visual Studio to search headers in the Gecko SDK/include directory (with the "Additional Include Directories" setting in the "C/C++"->"General" tab). Do the same thing to include the Gecko SDK/lib directory (using the "Additional Library Directories" setting in the "Linker"->"General" tab). </li><li>Build your component. </li><li>Add a post-build event in Visual Studio to copy the XPCOM dll to Firefox's components directory with "copy $(OutDir)\&lt;yourXPCOM>.dll &lt;FirefoxDir>\components". </li><li>Copy the xpt file (typelib) generated by xpidl to the Firefox components directory. </li><li>Run regxpcom with "regxpcom -x &lt;GeckoSDK>\bin &lt;FireFoxDir>\components\&lt;yourXPCOM>.dll". </li><li>You can optionally configure Visual Studio to run and debug regxpcom to troubleshoot the previous step (thru the "Command", "Command Arguments" and "Working Directory" in the "Debugging" tab). It'll allow you to verify your dll gets loaded. The NSGetModule method makes for a good first breakpoint. </li><li>Build a simple unittest html file, using "netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");" to get access to XPConnect/XPCOM. Use the <a href="http://www.mozilla.org/scriptable/components_object.html">Components object</a> to create an instance of your component. </li><li>Attach to the running Firefox.exe process to debug the component. </li></ol>

<p>General thought:<br />
Java, Perl and Python can interoperate with XPCOM (see <a href="http://www.mozilla.org/projects/blackwood/">Blackwood</a> for Java, <a href="http://public.activestate.com/pyxpcom/">PyXPCOM</a> for Python and <a href="http://plxpcom.mozdev.org/docs/xpcom-perl.html">PlXPCOM</a> for Perl). I wonder how difficult it would be to support .Net? You would be able to call XPCOM from .Net and implement XPCOM components using in .Net.</p>

<span class="posted">Posted by Julien on July 15, 2004. <a href="http://blog.monstuff.com/archives/000192.html" rel="bookmark">Permalink</a> 
<br /></span>

</div>



<div class="comments-head"><a name="comments"></a>Comments</div>

<div class="comments-body">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'curiosityisbliss'; 
        var disqus_identifier = '192';
        var disqus_url = 'http://blog.monstuff.com/archives/000192.html';

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>    




<div class="comments-body">
<p>Sorry, it don't work with me.<br />
I have an exception when I run my javascipt ("classe has no property")</p>
<span class="comments-post">Posted by: <a href="mailto&#58;simon_triplet&#64;yahoo&#46;fr">sim</a> at January  1, 2005 03:42 AM</span>
</div>
<div class="comments-body">
<p>Erm so where's the errata section?</p>
<span class="comments-post">Posted by: <a href="mailto&#58;bookiemon&#64;hotmail&#46;com">Blurhead</a> at February 15, 2005 11:59 PM</span>
</div>
<div class="comments-body">
<p>I can't seem to find the errata anymore. It may have been integrated into an updated version of the main body?</p>
<span class="comments-post">Posted by: <a href="http://blog.monstuff.com">Julien Couvreur</a> at February 17, 2005 10:20 AM</span>
</div>
<div class="comments-body">
<p><a href="http://www.mozilla.org/projects/xpcom/book/cxc/errata.html">http://www.mozilla.org/projects/xpcom/book/cxc/errata.html</a></p>
<span class="comments-post">Posted by: <a href="http://www.netscene.org">Craig</a> at February 19, 2005 04:23 PM</span>
</div>
<div class="comments-body">
<p>same as sim.<br />
it doesn't work.<br />
javasript throw an exception "classe has no property"</p>
<span class="comments-post">Posted by: <a href="mailto&#58;ificanfly1&#64;hotmail&#46;com">sky_water</a> at July 15, 2005 04:58 AM</span>
</div>
<div class="comments-body">
<p>i want know how to change functionality of fireox<br />
using xpcom in linux any one can tell me which step i should follow to create my own components....<br />
thanx in advance.....<br />
</p>
<span class="comments-post">Posted by: <a href="mailto&#58;balnpatil&#64;gmail&#46;com">patil balaji</a> at June 21, 2006 05:33 AM</span>
</div>
<div class="comments-body">
<p>Can anyone help me in integrating flash player in XPCOM.</p>
<span class="comments-post">Posted by: <a href="mailto&#58;amols&#64;alohatechnology&#46;com">Amol</a> at July 26, 2006 05:14 AM</span>
</div>
<div class="comments-body">
<p>Abv details about xpcom in c++ is very clear and good......<br />
 <br />
PLZ give details abt " How to write XPCOM component in JAVA"</p>
<span class="comments-post">Posted by: <a href="mailto&#58;sahaja_ss&#64;yahoo&#46;com">FPK</a> at August 17, 2006 10:27 PM</span>
</div>



</div>
</div>


</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />

<title>Curiosity is bliss: C# port of dChat</title>

<link rel="stylesheet" href="http://blog.monstuff.com/styles-site.css" type="text/css" />
<link rel="alternate" type="application/rss+xml" title="RSS" href="http://blog.monstuff.com/index.rdf" />

<link rel="start" href="http://blog.monstuff.com/" title="Home" />
<link rel="prev" href="http://blog.monstuff.com/archives/000173.html" title="More TypeKey thoughts" />

<link rel="next" href="http://blog.monstuff.com/archives/000129.html" title="Remote Javascript Scripting" />



<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-74363-1";
urchinTracker();
</script>

<script type="text/javascript" language="javascript">
<!--

function OpenTrackback (c) {
    window.open(c,
                    'trackback',
                    'width=480,height=480,scrollbars=yes,status=yes');
}

var HOST = 'blog.monstuff.com';

// Copyright (c) 1996-1997 Athenia Associates.
// http://www.webreference.com/js/
// License is granted if and only if this entire
// copyright notice is included. By Tomer Shiran.

function setCookie (name, value, expires, path, domain, secure) {
    var curCookie = name + "=" + escape(value) + ((expires) ? "; expires=" + expires.toGMTString() : "") + ((path) ? "; path=" + path : "") + ((domain) ? "; domain=" + domain : "") + ((secure) ? "; secure" : "");
    document.cookie = curCookie;
}

function getCookie (name) {
    var prefix = name + '=';
    var c = document.cookie;
    var nullstring = '';
    var cookieStartIndex = c.indexOf(prefix);
    if (cookieStartIndex == -1)
        return nullstring;
    var cookieEndIndex = c.indexOf(";", cookieStartIndex + prefix.length);
    if (cookieEndIndex == -1)
        cookieEndIndex = c.length;
    return unescape(c.substring(cookieStartIndex + prefix.length, cookieEndIndex));
}

function deleteCookie (name, path, domain) {
    if (getCookie(name))
        document.cookie = name + "=" + ((path) ? "; path=" + path : "") + ((domain) ? "; domain=" + domain : "") + "; expires=Thu, 01-Jan-70 00:00:01 GMT";
}

function fixDate (date) {
    var base = new Date(0);
    var skew = base.getTime();
    if (skew > 0)
        date.setTime(date.getTime() - skew);
}

function rememberMe (f) {
    var now = new Date();
    fixDate(now);
    now.setTime(now.getTime() + 365 * 24 * 60 * 60 * 1000);
    setCookie('mtcmtauth', f.author.value, now, '', HOST, '');
    setCookie('mtcmtmail', f.email.value, now, '', HOST, '');
    setCookie('mtcmthome', f.url.value, now, '', HOST, '');
}

function forgetMe (f) {
    deleteCookie('mtcmtmail', '', HOST);
    deleteCookie('mtcmthome', '', HOST);
    deleteCookie('mtcmtauth', '', HOST);
    f.email.value = '';
    f.author.value = '';
    f.url.value = '';
}

//-->
</script>



<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="http://blog.monstuff.com/archives/000172.html">
<dc:title>C# port of dChat</dc:title>
<dc:description>I ported dChat, an IRC-like web chat , to C#. Try the online demo of the original dChat. My goal was to make it really easy to use on windows/IIS in a windows domain. So, no compilation is needed, as you can run it by just deploying the source files to an IIS webserver and configuring the &quot;Directory Security&quot; to only use &quot;Integrated Windows authentication&quot;. You can then load the url for chat.aspx in a browser and start using it. A useful configuration is to add chat.aspx to the &quot;Default Document&quot; list, so that if you load the url for...</dc:description>
<dc:creator>Julien</dc:creator>
<dc:date>2004-05-03T12:51:07-08:00</dc:date>
<license rdf:resource="http://creativecommons.org/licenses/by-sa/1.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-sa/1.0/">
<requires rdf:resource="http://web.resource.org/cc/Attribution" />
<requires rdf:resource="http://web.resource.org/cc/Notice" />
<requires rdf:resource="http://web.resource.org/cc/ShareAlike" />
<permits rdf:resource="http://web.resource.org/cc/Reproduction" />
<permits rdf:resource="http://web.resource.org/cc/Distribution" />
<permits rdf:resource="http://web.resource.org/cc/DerivativeWorks" />
</License>
</rdf:RDF>
-->



</head>

<body>

<div id="banner">
<h1><a href="http://blog.monstuff.com/" accesskey="1">Curiosity is bliss</a></h1>
<span class="description">Julien Couvreur's programming blog and more</span>
</div>

<div id="container">

<div class="blog">







<div id="menu">
<a href="http://blog.monstuff.com/archives/000173.html">« More TypeKey thoughts</a>&nbsp;&nbsp; 

| &nbsp;&nbsp;<a href="/archives.html">Archive list</a>&nbsp;&nbsp;
| &nbsp;&nbsp;<a href="http://blog.monstuff.com/archives/000380.html">Thick displays</a> (latest)

</div>

</div>

<div class="blog">

<!-- <h2 class="date">May 03, 2004</h2> -->




<div class="blogbody">
<!-- google_ad_section_start -->

<h2 class="title">C# port of dChat</h2>

<p>I ported dChat, an IRC-like web chat , to C#. Try the <a href="http://bodytag.org/dchat/">online demo of the original dChat</a>.</p>

<p>My goal was to make it really easy to use on windows/IIS in a windows domain. So, <b>no compilation</b> is needed, as you can run it by just deploying the source files to an IIS webserver and configuring the "Directory Security" to only use "Integrated Windows authentication".<br />
You can then load the url for chat.aspx in a browser and start using it.</p>

<p>A useful configuration is to add chat.aspx to the "Default Document" list, so that if you load the url for the directory instead, it'll default to dnChat.</p>

<p>One of the differences with the dChat is that there is <b>no DB</b> or persistent storage (at least yet).<br />
Another difference is the use of windows authentication.</p>

<p>Get the <a href="/archives/images/dnChat.v1.zip">zipped source files</a> for dnChat.</p>

<a name="more"></a>
<p>The files:<br />
<ul><li>chat.aspx: is a mostly static html file that has includes javascript remoting tricks to communicate to f.ashx.</li><li>f.ashx: a C# HTTPHandler that handles the remote function calls from the browser.</li><li>online.js: some utility javascript functions. Some of the javascript from chat.aspx could be moved in there too...</li></ul></p>

<p>Note: The <a href="http://www.microsoft.com/netframework/">.Net framework</a> needs to be installed on the machine in order to run C#. No need for the SDK, the redistributable is enough. Also IIS needs to be configured to use it (which should automatically get setup when installing .Net), but in case it is not, you can run "aspnet_regiis -i" to fix it.</p>

<p>The poll rate is currently set to 3 seconds, but it should be easy to make it adaptative: the server could set it to 10 or 15 seconds if you haven't received a message for a long time, but when the channel is active it could go back down to 3 seconds.</p>

<p><u>Update:</u> Since a couple of people showed interest in extending dnChat, I started a <a href="https://sourceforge.net/projects/dnchat/">dnChat Sourceforge project</a> with Weston Weems.<br />
Also, Mesalem posted a variation on dnChat at the Code Project, check out <a href="http://www.codeproject.com/aspnet/AliAspNetChat.asp">"Simple Chat Application in ASP.NET"</a>.</p>

<p><u>Update:</u> ASP.Net 2.0 comes with a remote scripting feature: <a href="http://normen.mine.nu/myblog/viewpost.aspx?PostID=113">client callbacks</a> (<a href="http://www.codeproject.com/aspnet/ClientCallBackAspNet2.asp">via</a>).</p>

<p><br />
<u>Update (2005/05/11):</u> Fixed an issue with unicode characters not being transmitted properly. Now using <a href="http://blog.hackedbrain.com/archive/2005/04/11/370.aspx">encodeURIComponent instead of escape</a> for unicode characters on the querystring. Updated the zip file above and on Sourceforge.<br />
Thanks to Vitor Cardoso for pointing the issue out and troubleshooting with me.</p>

<span class="posted">Posted by Julien on May 03, 2004. <a href="http://blog.monstuff.com/archives/000172.html" rel="bookmark">Permalink</a> <!-- -->
<br /></span>

</div>



<div class="comments-head"><a name="comments"></a>Comments</div>

<div class="comments-body">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'curiosityisbliss'; 
        var disqus_identifier = '172';
        var disqus_url = 'http://blog.monstuff.com/archives/000172.html';

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>    





<div class="comments-body">
<p>I am trying to use your app but i dont want to have an account for every<br />
user.  Is there a way to allow anonymous with different usernames?  Or a<br />
better way to explain to the users other then trial and error with<br />
optional user names. (If 2 users login with the same name one gets<br />
kicked)</p>

<p><br />
Thanks,<br />
Brian</p>
<span class="comments-post">Posted by: <a href="http://www.brianyelm.com">Brian Yelm</a> at September  1, 2004 03:14 PM</span>
</div>
<div class="comments-body">
<p>Brian,<br />
I had deleted your comment by mistake, so I re-posted it and replied by email.<br />
When I ported dChat to C# I changed the authentication model to use network authentication as part of a windows domain. This solves the issue of unique usernames, because the domain controller ensures there is no collision.</p>

<p>I wouldn't be too difficult to switch back to the dChat model, where you just pick your own username. But then, like you pointed out, you need to handle the duplicate username case. I would probably list the usernames of the people currently using the system, on the "login" page, so that you can tell which ones are already taken...</p>
<span class="comments-post">Posted by: <a href="http://blog.monstuff.com">Julien Couvreur</a> at September  1, 2004 03:22 PM</span>
</div>
<div class="comments-body">
<p>Hi Julien,</p>

<p>Could you explain how to use this using Forms authentication instead of Windows authentication. I have my own accounting system so could fill the query string with a username, BUT, based on Forms auth.</p>

<p>The chat app looks clean and efficient, opposed to other I saw.</p>

<p>Thanks,</p>

<p>Danny</p>
<span class="comments-post">Posted by: <a href="mailto&#58;blogdotmonstuffdotcom&#64;webengineer&#46;nl">Danny</a> at September 11, 2004 08:03 AM</span>
</div>
<div class="comments-body">
<p><br />
Plz .i want to Know ow to Browse The Directory From  C# windows Button Command .</p>

<p><br />
</p>
<span class="comments-post">Posted by: <a href="mailto&#58;gour125&#64;rediffmail&#46;com">Dharmendra Gour</a> at October  4, 2004 07:47 AM</span>
</div>
<div class="comments-body">
<p>Oh rad!</p>
<span class="comments-post">Posted by: <a href="http://bodytag.org/">Glen Murphy</a> at October  6, 2004 09:22 PM</span>
</div>
<div class="comments-body">
<p>well i tried  installing net.framwork yet i still cannot get this application to work.  i 've read your docs posted on this page perhaps im missing something. ps im new to this</p>

<p>i've aslot tried executing the file C:\dnChat\chat.aspx  as a url and it didn't work, intead i get text in the aspx that pops up in notepad.</p>

<p>im running windows xp pro with net framework installed, php and perl</p>
<span class="comments-post">Posted by: <a href="mailto&#58;adawright&#64;hotmail&#46;com">ada</a> at November 20, 2004 07:29 PM</span>
</div>
<div class="comments-body">
<p>Hi Ada,</p>

<p>Could you check that you have the IIS webserver installed? To do this, go in the Start menu, select Run... and type "inetmgr". If you get an error, it means you didn't install IIS as part of your windows components.</p>

<p>If you have it installed, do you know where your document root is? A simple test is to put a file (say "test.txt" with a "hello" string in it) in that directory and try and load it in a browser (<a href="http://yourmachine/test.txt">http://yourmachine/test.txt</a> ). If you are able to get the "hello" in the browser than you are good to go and deploy the dnChat files into that directory.</p>

<p>Let me know how it goes.</p>
<span class="comments-post">Posted by: <a href="http://blog.monstuff.com">Julien</a> at November 23, 2004 11:21 AM</span>
</div>
<div class="comments-body">
<p>commnet the code on asp.net C#. </p>

<p>problem:</p>

<p>any user can use querystring <br />
<a href="http://localhost/chat.aspx?user=user1">http://localhost/chat.aspx?user=user1</a><br />
so sameone might type it and they might having<br />
same nick.</p>
<span class="comments-post">Posted by: <a href="mailto&#58;teoh_lian_tatt&#64;yahoo&#46;com">teoh</a> at February 12, 2005 07:57 AM</span>
</div>
<div class="comments-body">
<p>Teoh, you're right. But that code (looking at the "user" querystring parameter) is mostly for debugging, so that a single user can repro a multi-user scenario. </p>
<span class="comments-post">Posted by: <a href="http://blog.monstuff.com">Julien Couvreur</a> at February 17, 2005 10:22 AM</span>
</div>
<div class="comments-body">
<p>Hi Julien</p>

<p>This is a very nice and handy piece of code.<br />
I want to report that its not working with accented characters like French or Portuguese.<br />
Can you post a version working for these (often) forgotten languages ;) ?</p>

<p>Best regards</p>
<span class="comments-post">Posted by: <a href="mailto&#58;vcardoso&#64;hotmail&#46;com">vcard</a> at May  9, 2005 10:27 AM</span>
</div>
<div class="comments-body">
<p>Re: accented characters<br />
I just tried some accented characters like "&#276;&#277;&#279;&#280;&#280;&#1510;&#1511;&#1180;&#7845;&#7841;&#7811;&#1095;ÈÉÃ" but it was working fine. I tried both Firefox and IE for the browsers.<br />
Can you give me some more details on your repro? We can follow up on email.</p>
<span class="comments-post">Posted by: <a href="http://blog.monstuff.com">Julien</a> at May  9, 2005 10:38 AM</span>
</div>
<div class="comments-body">
<p>Can we do personal chat?</p>
<span class="comments-post">Posted by: <a href="mailto&#58;vishwadh&#64;gmail&#46;com">vishal</a> at August 31, 2005 05:28 AM</span>
</div>
<div class="comments-body">
<p>i need to know if there's a way to refresh the chat room faster without refreshing the whole page?</p>
<span class="comments-post">Posted by: <a href="mailto&#58;zouz&#64;hotmail&#46;com">joseph</a> at April 24, 2006 03:51 AM</span>
</div>
<div class="comments-body">
<p>Vishal,<br />
There is no support for channels and private conversations. I'm sure that now that some of the javascript techniques have become popular (AJAX trend), you should be able to find more powerful chat applications based on the same model.</p>

<p>Joseph, <br />
You can change the polling frequency for getting new messages, there should be no need to refresh the whole page. <br />
Using a different technique to get messages from the server (push), it should be possible to get the new messages instantly, without waiting for the next poll. Search for for "ajax comet" for more info.</p>
<span class="comments-post">Posted by: <a href="http://blog.monstuff.com">Julien Couvreur</a> at April 24, 2006 04:03 PM</span>
</div>
<div class="comments-body">
<p>Hi Julien</p>

<p>Is there a version to use in Sharepoint (wss)?</p>

<p>Thanks.</p>

<p>V.Cardoso</p>
<span class="comments-post">Posted by: <a href="mailto&#58;vcardoso&#64;hotmail&#46;com">v.cardoso</a> at June 28, 2006 09:12 AM</span>
</div>



<div class="comments-head"><a name="trackbacks"></a>Trackbacks</div>



<!-- google_ad_section_end -->

<div class="comments-body">
<!--
Comments are closed. You can <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#106;&#117;&#108;&#105;&#101;&#110;&#46;&#99;&#111;&#117;&#118;&#114;&#101;&#117;&#114;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;">contact me by email</a>. 
-->
</div>


</div>
</div>

<!-- google_ad_section_start(weight=ignore) -->
<div id="links">

<div class="sidetitle">
Recent Entries
</div>

<div class="side">
<a href="/archives.html">All entries (270)</a><br />
<br />

<a href="http://blog.monstuff.com/archives/000380.html">Thick displays</a><br />
<a href="http://blog.monstuff.com/archives/000377.html">Hans Rosling on the facts about population</a><br />
<a href="http://blog.monstuff.com/archives/000376.html">Bill Nye and Ken Ham debating on creationism</a><br />
<a href="http://blog.monstuff.com/archives/000375.html">Prediction vs Explanation</a><br />
<a href="http://blog.monstuff.com/archives/000374.html">Protectionism == Luddism</a><br />
<a href="http://blog.monstuff.com/archives/000373.html">Moderated off Boing Boing</a><br />
<a href="http://blog.monstuff.com/archives/000372.html">I &#9829; Patent Trolls</a><br />
<a href="http://blog.monstuff.com/archives/000371.html">Head Mounted Displays</a><br />
<a href="http://blog.monstuff.com/archives/000370.html">Better async programming in .Net</a><br />
<a href="http://blog.monstuff.com/archives/000369.html">Action, preferences, value</a><br />
<a href="http://blog.monstuff.com/archives/000368.html">Fresh breeze on climate debate</a><br />
<a href="http://blog.monstuff.com/archives/000367.html">On-the-fly book scanning</a><br />
<a href="http://blog.monstuff.com/archives/000366.html">State and education</a><br />
<a href="http://blog.monstuff.com/archives/000365.html">Live Geometry screencast</a><br />
<a href="http://blog.monstuff.com/archives/000364.html">Wired Science TV show</a><br />
<a href="http://blog.monstuff.com/archives/000362.html">Expectations and accountability in Economics</a><br />
<a href="http://blog.monstuff.com/archives/000361.html">Science of human action</a><br />
<a href="http://blog.monstuff.com/archives/000359.html">Reactive programming in javascript and C#</a><br />
<a href="http://blog.monstuff.com/archives/000358.html">Google Wave</a><br />
<a href="http://blog.monstuff.com/archives/000357.html">Reading facial expressions</a><br />

</div>
<!-- google_ad_section_end -->

</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />

<title>Curiosity is bliss: Javascript Shell bookmarklet for IE</title>

<link rel="stylesheet" href="http://blog.monstuff.com/styles-site.css" type="text/css" />
<link rel="alternate" type="application/rss+xml" title="RSS" href="http://blog.monstuff.com/index.rdf" />

<link rel="start" href="http://blog.monstuff.com/" title="Home" />
<link rel="prev" href="http://blog.monstuff.com/archives/000283.html" title="LiveClipboard: Wiring web and desktop apps together" />

<link rel="next" href="http://blog.monstuff.com/archives/000291.html" title="XmlHttpRequest Debugging for IE" />



<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-74363-1";
urchinTracker();
</script>

<script type="text/javascript" language="javascript">
<!--

function OpenTrackback (c) {
    window.open(c,
                    'trackback',
                    'width=480,height=480,scrollbars=yes,status=yes');
}

var HOST = 'blog.monstuff.com';

// Copyright (c) 1996-1997 Athenia Associates.
// http://www.webreference.com/js/
// License is granted if and only if this entire
// copyright notice is included. By Tomer Shiran.

function setCookie (name, value, expires, path, domain, secure) {
    var curCookie = name + "=" + escape(value) + ((expires) ? "; expires=" + expires.toGMTString() : "") + ((path) ? "; path=" + path : "") + ((domain) ? "; domain=" + domain : "") + ((secure) ? "; secure" : "");
    document.cookie = curCookie;
}

function getCookie (name) {
    var prefix = name + '=';
    var c = document.cookie;
    var nullstring = '';
    var cookieStartIndex = c.indexOf(prefix);
    if (cookieStartIndex == -1)
        return nullstring;
    var cookieEndIndex = c.indexOf(";", cookieStartIndex + prefix.length);
    if (cookieEndIndex == -1)
        cookieEndIndex = c.length;
    return unescape(c.substring(cookieStartIndex + prefix.length, cookieEndIndex));
}

function deleteCookie (name, path, domain) {
    if (getCookie(name))
        document.cookie = name + "=" + ((path) ? "; path=" + path : "") + ((domain) ? "; domain=" + domain : "") + "; expires=Thu, 01-Jan-70 00:00:01 GMT";
}

function fixDate (date) {
    var base = new Date(0);
    var skew = base.getTime();
    if (skew > 0)
        date.setTime(date.getTime() - skew);
}

function rememberMe (f) {
    var now = new Date();
    fixDate(now);
    now.setTime(now.getTime() + 365 * 24 * 60 * 60 * 1000);
    setCookie('mtcmtauth', f.author.value, now, '', HOST, '');
    setCookie('mtcmtmail', f.email.value, now, '', HOST, '');
    setCookie('mtcmthome', f.url.value, now, '', HOST, '');
}

function forgetMe (f) {
    deleteCookie('mtcmtmail', '', HOST);
    deleteCookie('mtcmthome', '', HOST);
    deleteCookie('mtcmtauth', '', HOST);
    f.email.value = '';
    f.author.value = '';
    f.url.value = '';
}

//-->
</script>



<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="http://blog.monstuff.com/archives/000287.html">
<dc:title>Javascript Shell bookmarklet for IE</dc:title>
<dc:description>The Javascript Shell is an awesome utility for javascript development. It was written by Jesse Ruderman and some other contributors. The bookmarklet version is the most useful, but it unfortunately only works in Firefox. Here is an updated version which brings some love to IE developers: Javascript Shell for IE bookmarklet. You might run into issues with pop-up blockers, in which case you can simply allow pop-ups from the site you&apos;re working with....</dc:description>
<dc:creator>Julien</dc:creator>
<dc:date>2006-04-19T15:28:08-08:00</dc:date>
<license rdf:resource="http://creativecommons.org/licenses/by-sa/1.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-sa/1.0/">
<requires rdf:resource="http://web.resource.org/cc/Attribution" />
<requires rdf:resource="http://web.resource.org/cc/Notice" />
<requires rdf:resource="http://web.resource.org/cc/ShareAlike" />
<permits rdf:resource="http://web.resource.org/cc/Reproduction" />
<permits rdf:resource="http://web.resource.org/cc/Distribution" />
<permits rdf:resource="http://web.resource.org/cc/DerivativeWorks" />
</License>
</rdf:RDF>
-->



</head>

<body>

<div id="banner">
<h1><a href="http://blog.monstuff.com/" accesskey="1">Curiosity is bliss</a></h1>
<span class="description">Julien Couvreur's programming blog and more</span>
</div>

<div id="container">

<div class="blog">







<div id="menu">
<a href="http://blog.monstuff.com/archives/000283.html">« LiveClipboard: Wiring web and desktop apps together</a>&nbsp;&nbsp; 

| &nbsp;&nbsp;<a href="/archives.html">Archive list</a>&nbsp;&nbsp;
| &nbsp;&nbsp;<a href="http://blog.monstuff.com/archives/000380.html">Thick displays</a> (latest)

</div>

</div>

<div class="blog">

<!-- <h2 class="date">April 19, 2006</h2> -->




<div class="blogbody">
<!-- google_ad_section_start -->

<h2 class="title">Javascript Shell bookmarklet for IE</h2>

<p>The <a href="http://www.squarefree.com/shell/">Javascript Shell</a> is an awesome utility for javascript development. It was written by Jesse Ruderman and some other contributors. <br />
The bookmarklet version is the most useful, but it unfortunately only works in Firefox.</p>

<p>Here is an updated version which brings some love to IE developers: <a href="javascript:function loadScript(scriptURL) { var scriptElem = document.createElement('SCRIPT'); scriptElem.setAttribute('language', 'JavaScript'); scriptElem.setAttribute('src', scriptURL); document.body.appendChild(scriptElem);} loadScript('http://blog.monstuff.com/archives/images/jsshell.js');" onclick="{alert('Don\'t click on this link, bookmark it instead');return false;}">Javascript Shell for IE</a> bookmarklet.<br />
You might run into issues with pop-up blockers, in which case you can simply allow pop-ups from the site you're working with.</p>

<a name="more"></a>
<p> <br />
<h4>Remote loading:</h4> The first problem with supporting IE is IE's limitation in bookmarklet size. Since version 5.5, IE only allows 512 characters in bookmarklets. <br />
The simple workaround is to use a small bookmarklet which acts as a bootstrap but doesn't contain the actual code. Instead it inserts a &lt;script> element to load the large script content remotely.<br />
Brad Neuberg has an <a href="http://codinginparadise.org/weblog/2005/08/ajax-creating-huge-bookmarklets.html">implementation of this remote loading bookmarklet</a>, which I re-used.<br />
The <a href="http://blog.monstuff.com/archives/images/jsshell.js">script file that is remotely loaded</a> is currently hosted on my blog, but I'd love to host it somewhere else. Hopefully, the caching headers should avoid a large part of the server traffic and load. Let me know if you have some alternative hosting suggestions.<br />
 <br />
<h4>Finding the caret position:</h4> The second problem was in the Javascript Shell code itself, with a function that figures out the position of the caret inside a textarea. That code didn't work in IE, as IE and Firefox use pretty different methods for dealing with selections.</p>

<p>Here is the fixed <i>getcaretpos</i> method, which uses a <a href="http://www.bazon.net/mishoo/articles.epl?art_id=1292">technique described by Mihai Bazon</a>:<br />
<div class="code">function getcaretpos(inp)<br />
{    <br />
&nbsp;&nbsp; if(inp.selectionEnd != null)<br />
&nbsp;&nbsp;&nbsp;&nbsp; return inp.selectionEnd;</p>

<p>&nbsp;&nbsp; // IE specific code<br />
&nbsp;&nbsp; var range = document.selection.createRange();<br />
&nbsp;&nbsp; var isCollapsed = range.compareEndPoints("StartToEnd", range) == 0;<br />
&nbsp;&nbsp; if (!isCollapsed)<br />
&nbsp;&nbsp;&nbsp;&nbsp; range.collapse(false);<br />
&nbsp;&nbsp; var b = range.getBookmark();<br />
&nbsp;&nbsp; return b.charCodeAt(2) - 2;<br />
}</div><br />
 <br />
<h4>Enumerating members of a javascript object:</h4> There is one more problem, with tab completion, which I couldn't fix yet. <br />
If you type "document.getE" and then press TAB, a couple of completions should be suggested to you, including "getElementsByName". <br />
This works in Firefox, but in IE it doesn't.</p>

<p>If you evaluate "document.getElementsByName" in IE, you get:<br />
"function getElementsByName() { [native code] }".<br />
So it looks like native methods don't get listed when enumerating the members of an object. A more direct repro is to call "props(document)" or evaluate "for(var i in document) { print(i); }". <br />
Within the Javascript Shell on Firefox this will list "getElementsByName" as one of the possibilities, but it's missing in the case of IE.</p>

<p>Any suggestions on how to work around this?</p>

<p><u>Update (2006/04/26):</u> I posted a <a href="http://media.putfile.com/Demo-of-the-Javascript-Shell-bookmarklet-in-IE">screencast of the Javascript Shell bookmarklet for IE</a> on PutFile (best viewed in "800" size).</p>

<p><u>Update (2006/05/01):</u> <a href="http://www.netcrucible.com/blog/">Joshua Allen</a>, who is now a technical evangelist on the IE7 team, pointed out that this bookmarklet doesn't work in the latest version of IE7. <br />
IE7 Beta 2 (5346.5) crashes when you try to launch the javascript shell from the bookmarklet. I'll follow up with him to investigate.</p>

<p><u>Update (2006/06/07):</u> I haven't identified the crashing issue yet, it didn't crash for me on all the versions of IE7 that I tried.<br />
I did a fix for IE7 though: you can now complete with Ctrl-Space, in addition to Tab. Tab doesn't work well, because it actually moves the focus to the new url bar in pop-up windows... Use Ctrl-Space instead.</p>

<span class="posted">Posted by Julien on April 19, 2006. <a href="http://blog.monstuff.com/archives/000287.html" rel="bookmark">Permalink</a> <!-- -->
<br /></span>

</div>



<div class="comments-head"><a name="comments"></a>Comments</div>

<div class="comments-body">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'curiosityisbliss'; 
        var disqus_identifier = '287';
        var disqus_url = 'http://blog.monstuff.com/archives/000287.html';

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>    





<div class="comments-body">
<p>Nice job - this is badly needed in IE.</p>
<span class="comments-post">Posted by: <a href="http://www.barelyfitz.com/">Patrick Fitzgerald</a> at April 28, 2006 02:38 PM</span>
</div>
<div class="comments-body">
<p>This script causes IE7 to crash?</p>

<p>This is badly needed for IE, it has been a great<br />
tool in Firefox and I hope to use it in IE.</p>

<p> </p>
<span class="comments-post">Posted by: <a href="mailto&#58;oksurf&#64;yahoo&#46;com">Oliver</a> at May 16, 2006 04:40 PM</span>
</div>
<div class="comments-body">
<p>What's about Opera?</p>
<span class="comments-post">Posted by: <a href="http://womensclothing.world-of-love.ru">Antonio</a> at June 25, 2006 01:47 PM</span>
</div>



<div class="comments-head"><a name="trackbacks"></a>Trackbacks</div>

<div class="trackback-body">
<a name="985"></a>
<span class="trackback-post"><a href="http://blog.nanorails.com/articles/2006/05/15/javascript-console" target="new">Javascript console</a><br />
<b>Excerpt:</b> Javascript is great when it works. When it doesn<br />
<b>Weblog:</b> nano RAILS: development, testing and hosting tidbits<br />
<b>Tracked:</b> May 16, 2006 12:23 AM</span>
</div>


<!-- google_ad_section_end -->

<div class="comments-body">
<!--
Comments are closed. You can <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#106;&#117;&#108;&#105;&#101;&#110;&#46;&#99;&#111;&#117;&#118;&#114;&#101;&#117;&#114;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;">contact me by email</a>. 
-->
</div>


</div>
</div>

<!-- google_ad_section_start(weight=ignore) -->
<div id="links">

<div class="sidetitle">
Recent Entries
</div>

<div class="side">
<a href="/archives.html">All entries (270)</a><br />
<br />

<a href="http://blog.monstuff.com/archives/000380.html">Thick displays</a><br />
<a href="http://blog.monstuff.com/archives/000377.html">Hans Rosling on the facts about population</a><br />
<a href="http://blog.monstuff.com/archives/000376.html">Bill Nye and Ken Ham debating on creationism</a><br />
<a href="http://blog.monstuff.com/archives/000375.html">Prediction vs Explanation</a><br />
<a href="http://blog.monstuff.com/archives/000374.html">Protectionism == Luddism</a><br />
<a href="http://blog.monstuff.com/archives/000373.html">Moderated off Boing Boing</a><br />
<a href="http://blog.monstuff.com/archives/000372.html">I &#9829; Patent Trolls</a><br />
<a href="http://blog.monstuff.com/archives/000371.html">Head Mounted Displays</a><br />
<a href="http://blog.monstuff.com/archives/000370.html">Better async programming in .Net</a><br />
<a href="http://blog.monstuff.com/archives/000369.html">Action, preferences, value</a><br />
<a href="http://blog.monstuff.com/archives/000368.html">Fresh breeze on climate debate</a><br />
<a href="http://blog.monstuff.com/archives/000367.html">On-the-fly book scanning</a><br />
<a href="http://blog.monstuff.com/archives/000366.html">State and education</a><br />
<a href="http://blog.monstuff.com/archives/000365.html">Live Geometry screencast</a><br />
<a href="http://blog.monstuff.com/archives/000364.html">Wired Science TV show</a><br />
<a href="http://blog.monstuff.com/archives/000362.html">Expectations and accountability in Economics</a><br />
<a href="http://blog.monstuff.com/archives/000361.html">Science of human action</a><br />
<a href="http://blog.monstuff.com/archives/000359.html">Reactive programming in javascript and C#</a><br />
<a href="http://blog.monstuff.com/archives/000358.html">Google Wave</a><br />
<a href="http://blog.monstuff.com/archives/000357.html">Reading facial expressions</a><br />

</div>
<!-- google_ad_section_end -->

</body>
</html>

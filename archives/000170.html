<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />

<title>Curiosity is bliss: TypeKey is live (beta)</title>

<link rel="stylesheet" href="http://blog.monstuff.com/styles-site.css" type="text/css" />
<link rel="alternate" type="application/rss+xml" title="RSS" href="http://blog.monstuff.com/index.rdf" />

<link rel="start" href="http://blog.monstuff.com/" title="Home" />
<link rel="prev" href="http://blog.monstuff.com/archives/000167.html" title="Microsoft Passport 101" />

<link rel="next" href="http://blog.monstuff.com/archives/000173.html" title="More TypeKey thoughts" />



<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-74363-1";
urchinTracker();
</script>

<script type="text/javascript" language="javascript">
<!--

function OpenTrackback (c) {
    window.open(c,
                    'trackback',
                    'width=480,height=480,scrollbars=yes,status=yes');
}

var HOST = 'blog.monstuff.com';

// Copyright (c) 1996-1997 Athenia Associates.
// http://www.webreference.com/js/
// License is granted if and only if this entire
// copyright notice is included. By Tomer Shiran.

function setCookie (name, value, expires, path, domain, secure) {
    var curCookie = name + "=" + escape(value) + ((expires) ? "; expires=" + expires.toGMTString() : "") + ((path) ? "; path=" + path : "") + ((domain) ? "; domain=" + domain : "") + ((secure) ? "; secure" : "");
    document.cookie = curCookie;
}

function getCookie (name) {
    var prefix = name + '=';
    var c = document.cookie;
    var nullstring = '';
    var cookieStartIndex = c.indexOf(prefix);
    if (cookieStartIndex == -1)
        return nullstring;
    var cookieEndIndex = c.indexOf(";", cookieStartIndex + prefix.length);
    if (cookieEndIndex == -1)
        cookieEndIndex = c.length;
    return unescape(c.substring(cookieStartIndex + prefix.length, cookieEndIndex));
}

function deleteCookie (name, path, domain) {
    if (getCookie(name))
        document.cookie = name + "=" + ((path) ? "; path=" + path : "") + ((domain) ? "; domain=" + domain : "") + "; expires=Thu, 01-Jan-70 00:00:01 GMT";
}

function fixDate (date) {
    var base = new Date(0);
    var skew = base.getTime();
    if (skew > 0)
        date.setTime(date.getTime() - skew);
}

function rememberMe (f) {
    var now = new Date();
    fixDate(now);
    now.setTime(now.getTime() + 365 * 24 * 60 * 60 * 1000);
    setCookie('mtcmtauth', f.author.value, now, '', HOST, '');
    setCookie('mtcmtmail', f.email.value, now, '', HOST, '');
    setCookie('mtcmthome', f.url.value, now, '', HOST, '');
}

function forgetMe (f) {
    deleteCookie('mtcmtmail', '', HOST);
    deleteCookie('mtcmthome', '', HOST);
    deleteCookie('mtcmtauth', '', HOST);
    f.email.value = '';
    f.author.value = '';
    f.url.value = '';
}

//-->
</script>



<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="http://blog.monstuff.com/archives/000170.html">
<dc:title>TypeKey is live (beta)</dc:title>
<dc:description>I ran into a site that is running MovableType 3.0 (beta1) with TypeKey support. There is no public protocol doc yet (afaik), but here&apos;s a quick analysis attempt....</dc:description>
<dc:creator>Julien</dc:creator>
<dc:date>2004-04-23T11:31:31-08:00</dc:date>
<license rdf:resource="http://creativecommons.org/licenses/by-sa/1.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-sa/1.0/">
<requires rdf:resource="http://web.resource.org/cc/Attribution" />
<requires rdf:resource="http://web.resource.org/cc/Notice" />
<requires rdf:resource="http://web.resource.org/cc/ShareAlike" />
<permits rdf:resource="http://web.resource.org/cc/Reproduction" />
<permits rdf:resource="http://web.resource.org/cc/Distribution" />
<permits rdf:resource="http://web.resource.org/cc/DerivativeWorks" />
</License>
</rdf:RDF>
-->



</head>

<body>

<div id="banner">
<h1><a href="http://blog.monstuff.com/" accesskey="1">Curiosity is bliss</a></h1>
<span class="description">Julien Couvreur's programming blog and more</span>
</div>

<div id="container">

<div class="blog">







<div id="menu">
<a href="http://blog.monstuff.com/archives/000167.html">« Microsoft Passport 101</a>&nbsp;&nbsp; 

| &nbsp;&nbsp;<a href="/archives.html">Archive list</a>&nbsp;&nbsp;
| &nbsp;&nbsp;<a href="http://blog.monstuff.com/archives/000380.html">Thick displays</a> (latest)

</div>

</div>

<div class="blog">

<!-- <h2 class="date">April 23, 2004</h2> -->




<div class="blogbody">
<!-- google_ad_section_start -->

<h2 class="title">TypeKey is live (beta)</h2>

<p>I ran into a <a href="http://stupidevilbastard.com">site that is running MovableType 3.0 (beta1)</a> with TypeKey support.</p>

<p>There is no public protocol doc yet (afaik), but here's a quick analysis attempt.</p>

<a name="more"></a>
<p>Let's start with some shameless plugs to my previous posts on web authentication, for some background on existing solutions. <a href="/archives/000167.html">"Microsoft Passport 101"</a> (a detailled explanation of Microsoft's protocol) and <a href="/archives/000153.html">"Comment authentication"</a> (an investigation on alternative protocols).<br />
Now, let's dive into the details of TypeKey (which seems similar in design to Passport, but with less features/options and is more open).</p>

<p><b>Authentication request:</b><br />
Whenever you register an account, you can also enlist your blog. In that case a blog token is provided to you, for the blog urls you declare. It looks like "LjRd2DpifL51sB0iFeYT".<br />
This token is passed in the authentication request (as the <b>t</b> parameter) along with return url (<b>_return</b>). The return url is checked against the blog urls you enlisted for.</p>

<p>So a login url follows this format (notice that the url is static for a given blog): <i>https://www.typekey.com/t/typekey/login?t=&lt;blog&nbsp;token>&_return=&lt;return&nbsp;url></i></p>

<p><br />
<b>Successful authentication:</b><br />
The return request contains the time (epoch format) of the authentication (<b>ts</b> parameter), the TypeKey login name (<b>name</b>), some kind of hash of the email (<b>email</b>), the display name (<b>nick</b>) and a secure signature (<b>sig</b>).</p>

<p>So, after you authenticate with TypeKey, you are returned to a url like: <i>&lt;return&nbsp;url>&ts=&lt;timestamp>&email=&lt;hashed&nbsp;email>&name=&lt;name>&nick=&lt;display&nbsp;name>&sig=&lt;crypto&nbsp;signature></i></p>

<p>Real parameters would look like:<br />
&lt;Return&nbsp;Url>&ts=1082595857<br />
&email=a4426c6a28b21941e3de8b14541e10e5aabb24e8<br />
&name=dumky<br />
&nick=Julien%20Couvreur%20%28Dumky%29<br />
&sig=vuXeBVRJG2cR4xl81+HoeJMbKYs=:DBASoTXIQtlxs07jRblTLRk=</p>

<p>A SHA-1 hash is used for the email (like <a href="http://philringnalda.com/blog/2002/09/a_minor_victory.php">FOAF</a>). I confirmed it by <a href="http://philringnalda.com/rdf/sha1.cgi?s=mailto%3adumky%40ifrance%2ecom">computing the SHA-1 hash for mailto:dumky at ifrance.com</a>, and then also found out the url for <a href="http://profile.typekey.com/dumky/foaf.rdf">my TypeKey FOAF file</a>.<br />
I'm not sure how the query string is signed yet, probably a PGP type signature. The blog token is probably involved, so that signatures can't be re-used from sites to sites.</p>

<p><br />
<b>Variation:</b><br />
If <b>need_email=1</b> is part of the auth request, a consent checkbox is shown in the login prompt. In that case, a cleartext version of the email is returned instead of just a hash.<br />
<a href="http://idly.org/2004/04/21/mt_30b1_first_thoughts">Idly.org</a> uses this option.</p>

<p><br />
<b>Cookies:</b><br />
Also, the TypeKey site will set a cookie that looks like:<br />
Tp_commenter0 = b75783e8ef6b9433e014aed547fa028d</p>

<p>Since the TypeKey authentication occurs over SSL, I'm not sure why they didn't use a secure cookie. <br />
Also, this cookie is set in the same domain all the UI is displayed (for account management), which might be a risk in terms of script injection.<br />
For example, the Profile currently is vulnerable to a script injection (I notified the SixApart team as I did with similar problems with <a href="http://www.movabletype.org/docs/mtchanges.html#2.64%20(2003.05.28)">MovableType &lt;2.64</a> and used my profile page as a <a href="http://profile.typekey.com/dumky/">demo</a>), but lukily it resides in a separate domain <i>profile.typekey.com</i> instead of <i>www.typekey.com</i>.</p>

<p><br />
Back onto the blog site two cookies are set, that look like:<br />
Tp_commenter = PyL52XkB98cxSo2sE%3D%3AUvzQdLVyw38%20qJBIjKz4lj1HkDY%3D<br />
Commenter_name = Julien%20Couvreur%20%28Dumky%29</p>

<p><br />
<b>Logout:</b><br />
If you hit the mt-comments.cgi on the blog site, with <b>logout=1</b>, you'll get logged out of the blog and bounced on the TypeKey logout url (<i>https://www.typekey.com/t/typekey/logout?&_return=&lt;return&nbsp;url></i>).<br />
I'm not sure how the sign-out works when you logged into multiple sites, it might just not be supported.</p>

<p><br />
<b>Links:</b><br />
<a href="http://www.typekey.com/faq/">TypeKey's FAQ</a>.</p>

<p><u>Update:</u> I implemented a <a href="http://blog.monstuff.com/archives/000184.html">TypeKey authentication provider for ASP.Net</a>, based on the newly published official <a href="http://www.movabletype.org/docs/tk-apps.html">documentation of the TypeKey protocol</a>.</p>

<span class="posted">Posted by Julien on April 23, 2004. <a href="http://blog.monstuff.com/archives/000170.html" rel="bookmark">Permalink</a> <!-- -->
<br /></span>

</div>



<div class="comments-head"><a name="comments"></a>Comments</div>

<div class="comments-body">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'curiosityisbliss'; 
        var disqus_identifier = '170';
        var disqus_url = 'http://blog.monstuff.com/archives/000170.html';

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>    





<div class="comments-body">
<p>Thank you for the rundown of the protocol, very nice information.</p>

<p>Perhaps you'll write another post about any weaknesses in the protocol you might perceive? It'd be nice to learn how or if the protocol can be hacked or exploited, if there is any possibility to impersonate someone else, etc?</p>
<span class="comments-post">Posted by: <a href="http://jogin.com/weblog/">Tomas</a> at April 23, 2004 01:43 PM</span>
</div>
<div class="comments-body">
<p>If I am not mistake, logout is specific to the blog you are following the "Sign out" link from and *not* a Type Key service wide logout.</p>
<span class="comments-post">Posted by: <a href="http://www.srijith.net/trinetre/">Srijith</a> at April 25, 2004 09:08 PM</span>
</div>
<div class="comments-body">
<p>Tomas, I'll do that, probably after the official doc is published.</p>

<p>Srijith, that's what it looks like to me too. But for a good security and privacy handling, a single sign-on system should have a single sign-out ;-)</p>
<span class="comments-post">Posted by: <a href="http://blog.monstuff.com">Dumky</a> at April 26, 2004 09:44 AM</span>
</div>
<div class="comments-body">
<p>Is an SSL URL forced?</p>
<span class="comments-post">Posted by: <a href="http://www.graphicgroups.com">Mike</a> at August  5, 2004 04:15 PM</span>
</div>
<div class="comments-body">
<p>I just upgraded a blogs www.jointeffects.com to MT 3.15, and can't send email notifications any more. The error I get: <br />
Can't use string ("ARRAY(0x898e4cc)") as an ARRAY ref while "strict refs" in use at...<br />
Seems that quite a few people have this problem.</p>

<p>Did anyone solve it yet?</p>

<p>Thanks!<br />
</p>
<span class="comments-post">Posted by: <a href="http://www.centauria.com">another web designer</a> at March 31, 2005 06:05 PM</span>
</div>
<div class="comments-body">
<p>Perhaps you'll write another post about any weaknesses in the protocol you might perceive? It'd be nice to learn how or if the protocol can be hacked or exploited, if there is any possibility to impersonate someone else, etc?</p>
<span class="comments-post">Posted by: <a href="http://www.iwebstreet.com/turnkey-business-website.php">chris</a> at January 25, 2006 09:41 AM</span>
</div>



<div class="comments-head"><a name="trackbacks"></a>Trackbacks</div>

<div class="trackback-body">
<a name="22"></a>
<span class="trackback-post"><a href="http://enthusiasm.cozy.org/archives/000593.html" target="new">TypeKey Revealed.</a><br />
<b>Excerpt:</b>  Over here somebody has been doing some reverse engineering of the TypeKey authentication protocol. I want to pick that apart a bit since I think this is going to spread fast once it's released. It's a good thing for people to know what's going on. The...<br />
<b>Weblog:</b> Ascription is an anathema to any enthusiasm<br />
<b>Tracked:</b> April 24, 2004 02:01 PM</span>
</div>
<div class="trackback-body">
<a name="23"></a>
<span class="trackback-post"><a href="http://www.jayallen.org/misc/trash/mtbeta/2004/04/deconstruction_of_tk_authentication" target="new">Deconstruction of TK authentication</a><br />
<b>Excerpt:</b> Hey, look at that! Someone did a fairly deep deconstruction of the TypeKey authentication process. I only briefly read over it after the initial few paragraphs. It looks pretty good. Of course, they could have waited until the docs came...<br />
<b>Weblog:</b> Jay's Super Secret Test Blog<br />
<b>Tracked:</b> April 24, 2004 03:04 PM</span>
</div>
<div class="trackback-body">
<a name="24"></a>
<span class="trackback-post"><a href="http://blog.arvind-satya.com/archives/2004/04/beta_testing.php" target="new">Beta Testing</a><br />
<b>Excerpt:</b> Well Movable Type beta testing is going along fine. Bugs are being reported and fixed, patches are being released and so are timestamp builds. Typekey has gone belly up and configurations have had to be changed and have become a...<br />
<b>Weblog:</b> Chinwags From Abu Dhabi ~ Into the Mind of Arvind Satyanarayan<br />
<b>Tracked:</b> April 25, 2004 05:24 AM</span>
</div>


<!-- google_ad_section_end -->

<div class="comments-body">
<!--
Comments are closed. You can <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#106;&#117;&#108;&#105;&#101;&#110;&#46;&#99;&#111;&#117;&#118;&#114;&#101;&#117;&#114;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;">contact me by email</a>. 
-->
</div>


</div>
</div>

<!-- google_ad_section_start(weight=ignore) -->
<div id="links">

<div class="sidetitle">
Recent Entries
</div>

<div class="side">
<a href="/archives.html">All entries (270)</a><br />
<br />

<a href="http://blog.monstuff.com/archives/000380.html">Thick displays</a><br />
<a href="http://blog.monstuff.com/archives/000377.html">Hans Rosling on the facts about population</a><br />
<a href="http://blog.monstuff.com/archives/000376.html">Bill Nye and Ken Ham debating on creationism</a><br />
<a href="http://blog.monstuff.com/archives/000375.html">Prediction vs Explanation</a><br />
<a href="http://blog.monstuff.com/archives/000374.html">Protectionism == Luddism</a><br />
<a href="http://blog.monstuff.com/archives/000373.html">Moderated off Boing Boing</a><br />
<a href="http://blog.monstuff.com/archives/000372.html">I &#9829; Patent Trolls</a><br />
<a href="http://blog.monstuff.com/archives/000371.html">Head Mounted Displays</a><br />
<a href="http://blog.monstuff.com/archives/000370.html">Better async programming in .Net</a><br />
<a href="http://blog.monstuff.com/archives/000369.html">Action, preferences, value</a><br />
<a href="http://blog.monstuff.com/archives/000368.html">Fresh breeze on climate debate</a><br />
<a href="http://blog.monstuff.com/archives/000367.html">On-the-fly book scanning</a><br />
<a href="http://blog.monstuff.com/archives/000366.html">State and education</a><br />
<a href="http://blog.monstuff.com/archives/000365.html">Live Geometry screencast</a><br />
<a href="http://blog.monstuff.com/archives/000364.html">Wired Science TV show</a><br />
<a href="http://blog.monstuff.com/archives/000362.html">Expectations and accountability in Economics</a><br />
<a href="http://blog.monstuff.com/archives/000361.html">Science of human action</a><br />
<a href="http://blog.monstuff.com/archives/000359.html">Reactive programming in javascript and C#</a><br />
<a href="http://blog.monstuff.com/archives/000358.html">Google Wave</a><br />
<a href="http://blog.monstuff.com/archives/000357.html">Reading facial expressions</a><br />

</div>
<!-- google_ad_section_end -->

</body>
</html>
